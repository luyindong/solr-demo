<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>添加商品</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<!-- 引入header -->
<th:block th:replace="common/header :: header"></th:block>

<div class="container mt-4">
    <h2>添加商品</h2>
    <form class="mt-4" method="post" th:action="@{/product/add}" th:object="${product}">
        <div class="mb-3">
            <label class="form-label">商品名称</label>
            <input class="form-control" required th:field="*{name}" type="text">
        </div>
        <div class="mb-3">
            <label class="form-label">价格</label>
            <input class="form-control" required step="0.01" th:field="*{price}" type="number">
        </div>
        <div class="mb-3">
            <label class="form-label">品牌</label>
            <select class="form-select" required th:field="*{brandId}">
                <option value="">请选择品牌</option>
                <option th:each="brand : ${brands}" th:text="${brand.name}" th:value="${brand.id}"></option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">类目</label>
            <select class="form-select" required th:field="*{categoryId}">
                <option value="">请选择类目</option>
                <option th:each="cat : ${categories}" th:text="${cat.name}" th:value="${cat.id}"></option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">库存</label>
            <input class="form-control" required th:field="*{stock}" type="number">
        </div>
        <div class="mb-3">
            <label class="form-label">商品图片</label>
            <input accept="image/*" class="form-control" id="imageFile" type="file">
            <input id="imageBase64" th:field="*{image}" type="hidden">
            <div class="mt-2" id="imagePreview"></div>
        </div>
        <div class="mb-3">
            <label class="form-label">描述</label>
            <textarea class="form-control" th:field="*{description}"></textarea>
        </div>
        <button class="btn btn-primary" type="submit">提交</button>
        <a class="btn btn-secondary" th:href="@{/product/list}">返回</a>
    </form>
    <div class="alert alert-success mt-3" th:if="${msg}" th:text="${msg}"></div>
</div>
<!-- 引入footer -->
<th:block th:replace="common/footer :: footer"></th:block>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fileInput = document.getElementById('imageFile');
        const imageBase64Input = document.getElementById('imageBase64');
        const imagePreview = document.getElementById('imagePreview');
        if (fileInput) {
            fileInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (evt) {
                        imageBase64Input.value = evt.target.result;
                        imagePreview.innerHTML = `<img src="${evt.target.result}" style="max-width:200px;max-height:200px;"/>`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    imageBase64Input.value = '';
                    imagePreview.innerHTML = '';
                }
            });
        }
        // 如果回显有图片
        if (imageBase64Input.value) {
            imagePreview.innerHTML = `<img src="${imageBase64Input.value}" style="max-width:200px;max-height:200px;"/>`;
        }
    });
</script>
</body>
</html> 